params {
    // Raw data directory
    dataDir             = "/media/seqadmin/datos/MN-COVID-SEQ/covid"
    scriptDir           = "${projectDir}/bin/"
    schemeDir           = "${projectDir}/schemes/"
    condaDir            = "${projectDir}/envs/conda/"
        env_general     = "${condaDir}/general.yml"
        env_artic       = "${condaDir}/artic.yml"
        env_pangolin    = "${condaDir}/pangolin.yml"
        env_nextclade   = "${condaDir}/nextclade.yml"
        env_proovframe  = "${condaDir}/proovframe.yml"      

    // Output directory
    analysisDir             = null

    // Analysis specific parameters
    samplesheet     = null
    runID           = null

    // Artic parameters
    min_len             = 500 // need to check requirements
    max_len             = 1700 // check requirements of artic
    normalise           = 200
    min_depth           = 20
    min_mapq            = 20
    scheme_name         = "Midnight-ONT"
    scheme_ver          = "V3"
}

// Executor configuration to limit concurrent processes
executor {
    name = 'local'
    cpus = 6        // Adjust based on your workstation (leave 2+ cores for system)
    memory = '12 GB' // Adjust based on your RAM (leave 4+ GB for system)
    queueSize = 4   // Maximum concurrent processes
}

// Process-level resource configuration
process {
    executor = 'local'
    shell = ['/bin/bash', '-euo', 'pipefail']
    
    // Default resources for all processes
    cpus = 1
    memory = '2 GB'
    
    // Specific configurations for different process types
    withLabel: 'artic' {
        cpus = 2
        memory = '4 GB'
        maxForks = 2  // Limit ARTIC processes to 2 concurrent
    }
    
    withLabel: 'assembly' {
        cpus = 2
        memory = '4 GB'
        maxForks = 1  // Only one assembly process at a time
    }
    
    withLabel: 'light' {
        cpus = 1
        memory = '1 GB'
    }
}

profiles {
    conda_on {
        conda.enabled   = true
        conda.useMamba  = false
        conda.cacheDir  = "/home/seqadmin/Bioinfo/75.SARS-CoV-2/.cache/"
    }

    docker_on {
        docker.enabled = true
        // this ensures container is run as host user and group, but
        //    also adds host user to the within-container group
        docker.runOptions = "--user \$(id -u):\$(id -g) --group-add 100"
    }

    singularity_on {
        singularity.enabled = true
        singularity.autoMounts = true
    }
    
    // Profile for even more conservative resource usage
    conservative {
        executor {
            queueSize = 2
            cpus = 4
            memory = '8 GB'
        }
        process {
            cpus = 1
            memory = '1 GB'
        }
    }
}

manifest {
    mainScript = 'main.nf'
    nextflowVersion = '>=23.10.1'
}